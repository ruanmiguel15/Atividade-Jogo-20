<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O Desafio do Olimpo: Prova Final</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

    <style>
        /* ================================== */
        /* CSS (Estiliza√ß√£o)                  */
        /* ================================== */
        body {
            font-family: 'Georgia', serif;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;

            background-image: url('https://aventurasnahistoria.com.br/wp-content/uploads/deuses_gregos.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed; 
        }

        .container {
            background-color: rgba(0, 0, 0, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.8);
            width: 100%;
            max-width: 800px;
            text-align: center;
            border: 4px solid gold;
            position: relative;
        }

        h1 {
            font-family: 'Cinzel Decorative', cursive;
            font-size: 2.8em;
            color: gold;
            margin-bottom: 25px;
            text-shadow: 2px 2px 7px rgba(0, 0, 0, 1);
        }
        
        /* --- TELA DE IN√çCIO STYLING --- */
        #start-screen {
            padding: 40px 20px;
            background-color: rgba(20, 20, 20, 0.9);
            border-radius: 10px;
            border: 2px solid #66ccff;
            margin-bottom: 20px;
        }
        #start-screen h2 {
            color: #fff;
            font-family: 'Cinzel Decorative', cursive;
            font-size: 2em;
            margin-bottom: 15px;
        }
        #start-screen p {
            color: #ccc;
            line-height: 1.5;
            margin-bottom: 10px;
        }
        #start-screen strong {
            color: gold;
        }
        #start-btn {
            background-color: #00ff88;
            color: #333;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 25px;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        #start-btn:hover {
            background-color: #00e07a;
            transform: translateY(-2px);
        }

        /* --- Barra de Status: N√≠vel, Pontos, Vidas e √ìbolos --- */
        #status-bar {
            display: grid;
            grid-template-columns: repeat(3, 1fr); 
            gap: 10px;
            margin-bottom: 15px;
            padding: 5px 0;
            font-size: 1.1em;
            color: #ccc;
            border-bottom: 1px solid rgba(255, 215, 0, 0.3);
        }
        .status-item span {
            color: gold;
            font-weight: bold;
        }
        
        #obolos-display {
            font-weight: bold;
            color: #66ccff; 
            margin-left: 5px;
        }

        #lives {
            color: #ff4d4d;
            font-size: 1.3em;
            margin-left: 5px;
        }

        /* --- Barras de Tempo e Progresso --- */
        #timer-bar-container {
            height: 10px;
            background-color: #555;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
            border: 1px solid #ff4d4d;
        }
        #timer-bar-fill {
            height: 100%;
            width: 100%;
            background-color: #ff4d4d;
            transition: width 1s linear;
        }

        #progress-bar-container {
            width: 90%;
            margin: 10px auto 30px auto;
            background-color: #555;
            border-radius: 5px;
            height: 15px;
            border: 1px solid gold;
            overflow: hidden;
        }
        #progress-bar-fill {
            height: 100%;
            width: 0%; 
            background-color: #00ff88;
            transition: width 0.5s ease;
        }

        h2 {
            font-size: 1.8em;
            margin-bottom: 20px;
            color: #f0f0f0;
        }

        #options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 25px;
        }

        .option-btn {
            background-color: #333;
            color: #fff;
            border: 2px solid #aaa;
            padding: 15px 20px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, border-color 0.3s ease;
            text-align: left;
        }

        .option-btn:hover:not(:disabled) {
            background-color: #555;
            transform: scale(1.01);
            border-color: yellow;
        }
        
        .option-btn.faded {
            opacity: 0.3;
            cursor: not-allowed;
            background-color: #1a1a1a;
        }

        /* --- Feedback e Explica√ß√£o --- */
        #feedback {
            margin-top: 25px;
            padding: 15px;
            border-radius: 8px;
            min-height: 30px;
            text-align: center;
            font-size: 1.1em;
            font-weight: normal;
        }
        .correct {
            color: #00ff88;
            background-color: rgba(0, 50, 0, 0.7);
            border: 1px solid #00ff88;
        }
        .incorrect {
            color: #ff6666;
            background-color: rgba(50, 0, 0, 0.7);
            border: 1px solid #ff6666;
        }
        .explanation {
            display: block;
            margin-top: 8px;
            font-size: 0.95em;
            font-style: italic;
            color: #ccc;
        }

        /* --- Bot√µes de A√ß√£o e Loja de Favores --- */
        #favors-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        #action-container {
             display: flex;
             justify-content: flex-end; 
        }
        
        #next-btn, #restart-btn, .favor-btn-item {
            background-color: gold;
            color: #333;
            border: none;
            padding: 12px 25px;
            font-size: 1em;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .favor-btn-item {
            background-color: #66ccff; 
            color: #000;
            padding: 8px 15px;
            font-size: 0.9em;
            line-height: 1.2;
        }
        .favor-btn-item:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #333;
            color: #aaa;
        }

        #next-btn:hover, #restart-btn:hover, .favor-btn-item:hover:not(:disabled) {
            background-color: rgb(255, 223, 0);
            transform: translateY(-2px);
        }

        .hidden {
            display: none;
        }

        #final-score, #final-title {
            color: gold;
            font-weight: bold;
            font-size: 1.5em;
            display: block;
        }
        
        .correct-answer {
            background-color: darkgreen !important;
            border-color: lightgreen !important;
            color: white !important;
            font-weight: bold;
        }

        /* --- Novo CSS para o Labirinto --- */
        #maze-game {
            background-image: url('https://i.imgur.com/h5r89yC.jpeg'); /* Imagem de fundo do labirinto */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            padding: 20px;
            border-radius: 15px;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.8);
        }

        #maze-container {
            display: inline-grid;
            border: 5px solid #a0522d;
            background-color: rgba(0, 0, 0, 0.7); /* Fundo semi-transparente para o mapa do labirinto */
            margin-top: 20px;
            box-shadow: 0 0 20px rgba(160, 82, 45, 0.5);
            user-select: none; 
            outline: none;
        }

        .maze-cell {
            width: 25px; 
            height: 25px; 
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1em; 
            font-weight: bold;
        }

        .wall {
            background-color: #5d3f2c;
            border: 1px solid #4a3225;
        }

        .path {
            background-color: rgba(26, 26, 26, 0.6); /* Caminho mais transparente */
        }

        .end {
            background-color: rgba(26, 26, 26, 0.6);
            color: gold;
        }

        .player {
            background-color: rgba(26, 26, 26, 0.6);
            color: #66ccff; /* Cor do Her√≥i */
            animation: pulse 1s infinite alternate;
        }

        .minotaur {
            background-color: rgba(26, 26, 26, 0.6);
            color: #ff4d4d; /* Cor do Minotauro */
            animation: growShrink 0.8s infinite alternate;
        }

        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }

        @keyframes growShrink {
            from { transform: scale(1); }
            to { transform: scale(1.2); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>O Desafio do Olimpo</h1>

        <div id="start-screen">
            <h2>Bem-vindo ao Templo da Sabedoria!</h2>
            <p>Prove seu conhecimento da Mitologia Grega para os Deuses do Olimpo.</p>
            <p>Voc√™ come√ßar√° como **Semi-Deus** e deve responder corretamente em **15 segundos** para avan√ßar.</p>
            <p>Cuidado! Voc√™ tem apenas **3 Liras (Vidas)**. Erros custam 1 Lira e -5 Pontos.</p>
            <p>Acertos concedem **Pontos de Sabedoria** e **√ìbolos** (moedas) que podem ser gastos em Favores.</p>
            <p>Ao completar todos os n√≠veis, voc√™ enfrentar√° a **Prova Final: A Fuga do Labirinto!**</p>

            <button id="start-btn">Come√ßar a Jornada</button>
        </div>
        
        <div id="game-info" class="hidden">
            <div id="status-bar">
                <div class="status-item">N√≠vel: <span id="current-level">Semi-Deus</span></div>
                <div class="status-item">Pontua√ß√£o: <span id="current-score">0</span></div>
                <div class="status-item">Vidas (Liras): <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div>
            </div>
            
            <div class="status-item" style="margin-bottom: 20px; text-align: right; border-bottom: none;">
                Moedas (√ìbolos ü™ô): <span id="obolos-display">0</span>
            </div>

            <div id="timer-bar-container">
                <div id="timer-bar-fill"></div>
            </div>

            <div id="progress-bar-container">
                <div id="progress-bar-fill"></div>
            </div>
        </div>


        <div id="quiz-area" class="hidden"> 
            <h2 id="question">Carregando pergunta...</h2>
            <div id="options-container">
                </div>
            
            <div id="feedback"></div>
            
            <div id="favors-container">
                <button id="favor-atena-btn" class="favor-btn-item" data-cost="5" data-favor-type="atena">Favor de Atena (50/50) <br> ü™ô 5 √ìbolos</button>
                <button id="favor-hermes-btn" class="favor-btn-item" data-cost="3" data-favor-type="hermes">Favor de Hermes (Dica) <br> ü™ô 3 √ìbolos</button>
            </div>
            
            <div id="action-container">
                <button id="next-btn" class="hidden">Pr√≥xima Jornada</button>
            </div>
        </div>
        
        <div id="result-area" class="hidden">
            <h2 id="result-title">Jornada Conclu√≠da!</h2>
            <p>Sua pontua√ß√£o final: <span id="final-score">0</span> Pontos de Sabedoria.</p>
            <p>Seu T√≠tulo no Olimpo: <span id="final-title"></span></p>
            <button id="restart-btn">Recome√ßar a Jornada</button>
        </div>

        <div id="maze-game" class="hidden">
            <h2 style="color: #ff6666;">A Prova Final: Fuga do Labirinto!</h2>
            <p style="color: #ccc;">Voc√™ √© o Her√≥i (üèÉ‚Äç‚ôÇÔ∏è) e deve fugir do terr√≠vel Minotauro (üêÇ) e encontrar a sa√≠da (‚ú®). Use as setas do teclado (‚Üë ‚Üì ‚Üê ‚Üí).</p>
            
            <div id="maze-container">
                </div>

            <p id="maze-message" style="color: #ffcc00; font-weight: bold; margin-top: 15px;">Fuja do Minotauro!</p>

            <button id="maze-restart-btn" class="hidden">Tentar Novamente (Recome√ßar Quiz)</button>
        </div>
    </div>

    <script>
        /* ========================================================== */
        /* JAVASCRIPT (L√≥gica Completa)                               */
        /* ========================================================== */
        document.addEventListener('DOMContentLoaded', () => {

            const questions = {
                easy: [
                    { question: "Qual deus grego √© o governante do Submundo?", options: ["Poseidon", "Zeus", "Hades", "Ares"], answer: "Hades", explanation: "Hades recebeu o dom√≠nio do submundo e dos mortos. Seu s√≠mbolo √© o Elmo da Escurid√£o." },
                    { question: "Quem foi a deusa da sabedoria, estrat√©gia e artes√£?", options: ["Hera", "Afrodite", "√Årtemis", "Atena"], answer: "Atena", explanation: "Atena nasceu da cabe√ßa de Zeus j√° adulta e em armadura, sendo a protetora da raz√£o e da guerra justa." },
                    { question: "Qual √© o s√≠mbolo principal de Poseidon, deus dos mares?", options: ["Raio", "Tridente", "Cetro", "Lira"], answer: "Tridente", explanation: "O Tridente era a arma de Poseidon, usada para agitar o mar e causar terremotos." },
                    { question: "Qual her√≥i matou a Medusa, usando um escudo espelhado?", options: ["H√©rcules", "Perseu", "Teseu", "Jas√£o"], answer: "Perseu", explanation: "Perseu usou o escudo de Atena como espelho para ver a Medusa sem ser transformado em pedra." },
                    { question: "Onde os deuses ol√≠mpicos residiam, de acordo com a mitologia?", options: ["Monte Parnaso", "Templo de √âfeso", "Monte Olimpo", "Ilha de Creta"], answer: "Monte Olimpo", explanation: "O Monte Olimpo era a morada dos principais deuses gregos, liderados por Zeus." },
                ],
                medium: [
                    { question: "Qual criatura mitol√≥gica habitava o Labirinto de Creta?", options: ["C√©rbero", "Hidra de Lerna", "Minotauro", "Esfinge"], answer: "Minotauro", explanation: "O Minotauro era uma criatura com corpo de homem e cabe√ßa de touro, morta pelo her√≥i Teseu." },
                    { question: "O her√≥i H√©rcules teve que realizar quantos 'Trabalhos' em penit√™ncia?", options: ["Sete", "Dez", "Doze", "Vinte"], answer: "Doze", explanation: "Os famosos Doze Trabalhos foram impostos a H√©rcules para purific√°-lo ap√≥s um ato de loucura." },
                    { question: "Qual deus imp√¥s a Prometeu a puni√ß√£o de ter seu f√≠gado comido por uma √°guia diariamente?", options: ["Hades", "Apolo", "Zeus", "Hefesto"], answer: "Zeus", explanation: "Zeus, o rei dos deuses, puniu Prometeu por roubar o fogo do Olimpo e entreg√°-lo √† humanidade." },
                    { question: "Qual √© o nome do barqueiro que transporta as almas atrav√©s do rio Estige no submundo?", options: ["S√≠sifo", "Sombra", "Caronte", "√ârebo"], answer: "Caronte", explanation: "Caronte era o barqueiro que exigia uma moeda (√≥bolo) para transportar as almas rec√©m-mortas." },
                    { question: "Qual deusa nasceu da espuma do mar e √© a deusa do amor e da beleza?", options: ["Afrodite", "√Årtemis", "Dem√©ter", "H√©stia"], answer: "Afrodite", explanation: "Afrodite emergiu das espumas do mar e √© o arqu√©tipo da beleza e do desejo." }
                ],
                hard: [
                    { question: "Antes dos Deuses Ol√≠mpicos, quem eram os governantes do universo na mitologia grega?", options: ["Gigantes", "Tit√£s", "Ciclopes", "Ninfas"], answer: "Tit√£s", explanation: "Os Tit√£s foram os governantes primordiais e foram derrubados pelos Deuses Ol√≠mpicos na Titanomaquia." },
                    { question: "Qual √© a divindade primordial que representa o Vazio ou a Aus√™ncia?", options: ["Gaia", "Eros", "Caos", "T√°rtaro"], answer: "Caos", explanation: "No in√≠cio, havia apenas o Caos, o Vazio primordial, do qual todas as outras divindades e elementos surgiram." },
                    { question: "O que S√≠sifo foi amaldi√ßoado a fazer eternamente no T√°rtaro?", options: ["Beber √°gua do mar", "Ter o f√≠gado comido", "Rolar uma pedra montanha acima", "Tocar a lira sem parar"], answer: "Rolar uma pedra montanha acima", explanation: "S√≠sifo foi condenado a rolar uma pedra morro acima, apenas para v√™-la rolar de volta, por ter enganado a morte." },
                    { question: "Qual dos seguintes n√£o √© um dos tr√™s ju√≠zes do submundo?", options: ["Minos", "Radamanto", "√âaco", "Cronos"], answer: "Cronos", explanation: "Cronos era um Tit√£. Os tr√™s ju√≠zes do submundo eram Minos, Radamanto e √âaco." },
                    { question: "Qual √© o nome do tit√£ que representa o tempo, pai de Zeus?", options: ["Urano", "Cronos", "Atlas", "Oceano"], answer: "Cronos", explanation: "Cronos (Titan) n√£o deve ser confundido com Chronos (deidade primordial do tempo). Cronos era o pai de Zeus, a quem ele destronou. " },
                ]
            };
            
            // NOVO MAPA DE LABIRINTO (15x15) MAIS DIF√çCIL
            // 0: Caminho, 1: Parede, 2: In√≠cio (Jogador), 3: Sa√≠da (Fim)
            const MAZE_MAP = [
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                [1, 2, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1],
                [1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0, 1],
                [1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1],
                [1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                [1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1],
                [1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1],
                [1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1],
                [1, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1],
                [1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1],
                [1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1],
                [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 3, 1],
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
            ];

            const levels = ['easy', 'medium', 'hard'];
            const levelTitles = { easy: 'Semi-Deus', medium: 'Her√≥i', hard: 'Tit√£' };
            const TIME_LIMIT = 15;

            // Elementos do DOM (Quiz)
            const startScreen = document.getElementById('start-screen');
            const startButton = document.getElementById('start-btn');
            const gameInfo = document.getElementById('game-info');
            const questionElement = document.getElementById('question');
            const optionsContainer = document.getElementById('options-container');
            const feedbackElement = document.getElementById('feedback');
            const nextButton = document.getElementById('next-btn');
            const quizArea = document.getElementById('quiz-area');
            const resultArea = document.getElementById('result-area');
            const finalScoreElement = document.getElementById('final-score');
            const finalTitleElement = document.getElementById('final-title');
            const restartButton = document.getElementById('restart-btn');
            const currentLevelElement = document.getElementById('current-level');
            const currentScoreElement = document.getElementById('current-score');
            const livesElement = document.getElementById('lives');
            const obolosDisplay = document.getElementById('obolos-display');
            const timerBarFill = document.getElementById('timer-bar-fill');
            const progressBarFill = document.getElementById('progress-bar-fill');
            const resultTitleElement = document.getElementById('result-title');
            const favorAtenaBtn = document.getElementById('favor-atena-btn');
            const favorHermesBtn = document.getElementById('favor-hermes-btn');

            // Elementos do DOM (Labirinto)
            const mazeGame = document.getElementById('maze-game');
            const mazeContainer = document.getElementById('maze-container');
            const mazeMessage = document.getElementById('maze-message');
            const mazeRestartBtn = document.getElementById('maze-restart-btn');

            // Vari√°veis de Estado
            let currentLevelIndex = 0;
            let currentQuestionIndex = 0;
            let score = 0;
            let lives = 3;
            let obolos = 0;
            let timerInterval;
            let timeElapsed = 0;
            
            const MAZE_ROWS = MAZE_MAP.length;
            const MAZE_COLS = MAZE_MAP[0].length;
            
            // Posi√ß√£o inicial do jogador (Busca no Mapa o '2')
            let playerPos = { row: -1, col: -1 };
            // Posi√ß√£o inicial do Minotauro (Pode ser definida para um local estrat√©gico)
            let minotaurPos = { row: -1, col: -1 };
            let minotaurMoveCounter = 0; // Contador para controlar o movimento do Minotauro


            // --- FUN√á√ïES DE UTILIDADE ---

            function triggerConfetti() {
                confetti({
                    particleCount: 150,
                    spread: 120,
                    origin: { y: 0.6 },
                    colors: ['#FFD700', '#DAA520', '#B8860B', '#FFFFFF'],
                });
            }

            function updateLivesDisplay() {
                livesElement.textContent = '‚ù§Ô∏è'.repeat(lives) + 'üñ§'.repeat(3 - lives);
            }

            function updateObolosDisplay() {
                obolosDisplay.textContent = obolos;
                updateFavorButtonsState();
            }
            
            function updateFavorButtonsState() {
                const favors = [favorAtenaBtn, favorHermesBtn];
                favors.forEach(btn => {
                    const cost = parseInt(btn.getAttribute('data-cost'));
                    btn.disabled = obolos < cost;
                });
            }

            // --- FUN√á√ïES DE CONTROLE DE JOGO ---

            function startGame() {
                // Oculta a tela inicial, mostra info e √°rea do quiz
                startScreen.classList.add('hidden');
                gameInfo.classList.remove('hidden');
                quizArea.classList.remove('hidden');
                restartGame(); 
            }

            function startTimer() {
                timeElapsed = 0;
                clearInterval(timerInterval);
                timerBarFill.style.width = '100%';
                
                timerInterval = setInterval(() => {
                    timeElapsed++;
                    const remainingPercent = 100 - (timeElapsed / TIME_LIMIT) * 100;
                    timerBarFill.style.width = remainingPercent + '%';

                    if (timeElapsed >= TIME_LIMIT) {
                        clearInterval(timerInterval);
                        // Passa a pergunta correta para avalia√ß√£o
                        checkAnswer(null, questions[levels[currentLevelIndex]][currentQuestionIndex]);
                    }
                }, 1000);
            }

            function checkAnswer(selectedOption, questionData) {
                clearInterval(timerInterval);
                
                favorAtenaBtn.disabled = true;
                favorHermesBtn.disabled = true;

                disableOptions(selectedOption, questionData.answer);
                nextButton.classList.remove('hidden');

                const explanationHTML = `<span class="explanation">**Ato de Sabedoria:** ${questionData.explanation}</span>`;

                if (selectedOption === questionData.answer) {
                    let points = 10;
                    let bonus = 0;
                    
                    if (timeElapsed <= 3) {
                        bonus = 5;
                        points += bonus;
                        feedbackElement.innerHTML = `‚úÖ Correto e R√ÅPIDO (+${points} PONTOS)! ${explanationHTML}`;
                    } else {
                        feedbackElement.innerHTML = `‚úÖ Correto! Voc√™ ganhou ${points} Pontos de Sabedoria. ${explanationHTML}`;
                    }
                    
                    feedbackElement.classList.remove('incorrect');
                    feedbackElement.classList.add('correct');
                    score += points;
                    obolos += 1;

                    triggerConfetti();

                } else {
                    lives--;
                    score = Math.max(0, score - 5);

                    if (selectedOption === null) {
                        feedbackElement.innerHTML = `‚è±Ô∏è O tempo acabou! -1 Lira. A resposta correta era: ${questionData.answer}. ${explanationHTML}`;
                    } else {
                        feedbackElement.innerHTML = `‚ùå Errado! -1 Lira e -5 Pontos. A resposta correta era: ${questionData.answer}. ${explanationHTML}`;
                    }
                    
                    feedbackElement.classList.remove('correct');
                    feedbackElement.classList.add('incorrect');
                }
                
                currentScoreElement.textContent = score;
                updateLivesDisplay();
                updateObolosDisplay();

                if (lives <= 0) {
                    showResult(true); // Fim de jogo por vidas
                }
            }

            function disableOptions(selectedOption, correctAnswer) {
                const buttons = optionsContainer.querySelectorAll('.option-btn');
                buttons.forEach(button => {
                    button.disabled = true;

                    if (button.textContent === correctAnswer) {
                        button.classList.add('correct-answer');
                    } else if (button.textContent === selectedOption) {
                        button.classList.add('incorrect'); 
                    }
                });
            }

            function loadQuestion() {
                if (lives <= 0) return;

                const currentLevelKey = levels[currentLevelIndex];
                const currentQuestions = questions[currentLevelKey];

                if (currentQuestionIndex < currentQuestions.length) {
                    // CORRE√á√ÉO: Usar currentQuestionIndex para pegar a pergunta correta
                    const currentQuestion = currentQuestions[currentQuestionIndex]; 
                    
                    currentLevelElement.textContent = levelTitles[currentLevelKey];
                    currentScoreElement.textContent = score;
                    updateObolosDisplay(); 
                    updateFavorButtonsState(); 

                    const totalQuestionsInLevel = currentQuestions.length;
                    // Progresso: (√çndice da Pergunta Atual / Total de Perguntas no N√≠vel) * 100
                    const progressPercent = (currentQuestionIndex / totalQuestionsInLevel) * 100;
                    progressBarFill.style.width = progressPercent + '%';

                    questionElement.textContent = currentQuestion.question;
                    optionsContainer.innerHTML = ''; 
                    
                    currentQuestion.options.forEach(option => {
                        const button = document.createElement('button');
                        button.classList.add('option-btn');
                        button.textContent = option;
                        button.addEventListener('click', () => checkAnswer(option, currentQuestion));
                        optionsContainer.appendChild(button);
                    });
                    
                    feedbackElement.textContent = '';
                    feedbackElement.className = '';
                    nextButton.classList.add('hidden');
                    startTimer();

                } else {
                    moveToNextLevel();
                }
            }

            function moveToNextLevel() {
                clearInterval(timerInterval);
                progressBarFill.style.width = '100%'; 
                
                obolos += 5;

                currentLevelIndex++;
                currentQuestionIndex = 0; // Reinicia o √≠ndice de perguntas para o novo n√≠vel
                
                if (currentLevelIndex < levels.length) {
                    const prevTitle = levelTitles[levels[currentLevelIndex - 1]];
                    const nextTitle = levelTitles[levels[currentLevelIndex]];
                    
                    alert(`üèÖ Ascens√£o! Voc√™ completou o N√≠vel ${prevTitle} e ganhou 5 √ìbolos de B√¥nus! Avance para o N√≠vel ${nextTitle}.`);
                    updateObolosDisplay();
                    loadQuestion();
                } else {
                    // Fim do Quiz - Inicia a Prova Final
                    startMazeGame();
                }
            }
            
            // --- FUN√á√ïES DOS FAVORES (LOJA) ---
            
            function useFavorAtena() {
                const cost = 5;
                if (obolos < cost) return;

                const currentQuestion = questions[levels[currentLevelIndex]][currentQuestionIndex];
                const correctAnswer = currentQuestion.answer;
                const buttons = optionsContainer.querySelectorAll('.option-btn');
                
                let incorrectOptions = [];
                buttons.forEach(button => {
                    if (button.textContent !== correctAnswer && !button.disabled) {
                        incorrectOptions.push(button);
                    }
                });

                const optionsToRemove = Math.min(2, incorrectOptions.length); 
                
                incorrectOptions.sort(() => 0.5 - Math.random());
                for (let i = 0; i < optionsToRemove; i++) {
                    incorrectOptions[i].disabled = true;
                    incorrectOptions[i].classList.add('faded');
                }

                obolos -= cost;
                updateObolosDisplay();
                feedbackElement.innerHTML = `‚úÖ Favor de Atena concedido! Duas op√ß√µes incorretas foram reveladas.`;
                feedbackElement.classList.remove('incorrect');
                feedbackElement.classList.add('correct');
            }

            function useFavorHermes() {
                const cost = 3;
                if (obolos < cost) return;
                
                const currentQuestion = questions[levels[currentLevelIndex]][currentQuestionIndex];
                const explanation = currentQuestion.explanation;

                obolos -= cost;
                updateObolosDisplay();

                feedbackElement.innerHTML = `üìú Favor de Hermes concedido! Dica de Sabedoria: ${explanation}`;
                feedbackElement.classList.remove('incorrect');
                feedbackElement.classList.add('correct');
            }

            // --- FINALIZA√á√ÉO E REIN√çCIO ---

            function getTitle(finalScore) {
                if (finalScore >= 150) return "Novo Imortal do Olimpo";
                if (finalScore >= 100) return "S√°bio Or√°culo de Delfos";
                if (finalScore >= 50) return "Her√≥i Consagrado";
                if (finalScore >= 10) return "Cidad√£o de Atenas";
                return "Estrangeiro Sem Rumo";
            }

            function showResult(isGameOver) {
                clearInterval(timerInterval);
                timerBarFill.style.width = '0%';
                
                quizArea.classList.add('hidden');
                gameInfo.classList.add('hidden');
                mazeGame.classList.add('hidden');
                resultArea.classList.remove('hidden');
                
                finalScoreElement.textContent = score;
                finalTitleElement.textContent = getTitle(score);
                
                if (isGameOver) {
                    resultTitleElement.textContent = "GAME OVER: A Jornada Foi Interrompida!";
                    // N√£o Confetes para Game Over, apenas no sucesso/ponto final.
                } else {
                    resultTitleElement.textContent = "Jornada Conclu√≠da!";
                    triggerConfetti();
                }
            }

            function restartGame() {
                currentLevelIndex = 0;
                currentQuestionIndex = 0;
                score = 0;
                lives = 3;
                obolos = 0;
                
                // Reinicia a posi√ß√£o do jogador e minotauro para o in√≠cio
                resetMazePositions();
                
                resultArea.classList.add('hidden');
                mazeGame.classList.add('hidden');
                gameInfo.classList.remove('hidden');
                quizArea.classList.remove('hidden');
                
                progressBarFill.style.width = '0%'; 
                updateLivesDisplay();
                updateObolosDisplay();
                loadQuestion();
            }

            // ==================================
            // L√ìGICA DO MINIGAME LABIRINTO
            // ==================================

            function resetMazePositions() {
                // Encontra a posi√ß√£o inicial do jogador (2)
                for (let r = 0; r < MAZE_ROWS; r++) {
                    for (let c = 0; c < MAZE_COLS; c++) {
                        if (MAZE_MAP[r][c] === 2) {
                            playerPos = { row: r, col: c };
                            break;
                        }
                    }
                }
                // Define uma posi√ß√£o inicial para o Minotauro (longe do jogador, mas em um caminho)
                minotaurPos = { row: 13, col: 12 }; // Posi√ß√£o estrat√©gica no canto oposto da sa√≠da
                if (MAZE_MAP[minotaurPos.row][minotaurPos.col] === 1 || MAZE_MAP[minotaurPos.row][minotaurPos.col] === 3) {
                     // Caso a posi√ß√£o padr√£o seja uma parede ou a sa√≠da, procurar outro lugar.
                     // Por simplicidade, vamos fixar essa, pois sabemos que √© um caminho no mapa atual.
                }
                minotaurMoveCounter = 0;
            }

            function renderMaze() {
                mazeContainer.innerHTML = '';
                // Define o grid com base no tamanho do novo mapa (15x15)
                mazeContainer.style.gridTemplateColumns = `repeat(${MAZE_COLS}, 1fr)`; 

                for (let r = 0; r < MAZE_ROWS; r++) {
                    for (let c = 0; c < MAZE_COLS; c++) {
                        const cell = document.createElement('div');
                        cell.classList.add('maze-cell');
                        
                        if (MAZE_MAP[r][c] === 1) { 
                            cell.classList.add('wall');
                        } else if (MAZE_MAP[r][c] === 3) { 
                            cell.classList.add('end');
                            cell.textContent = '‚ú®';
                        } else {
                            cell.classList.add('path');
                        }
                        
                        if (r === playerPos.row && c === playerPos.col) {
                            cell.classList.add('player');
                            cell.textContent = 'üèÉ‚Äç‚ôÇÔ∏è'; 
                        } else if (r === minotaurPos.row && c === minotaurPos.col) {
                            cell.classList.add('minotaur');
                            cell.textContent = 'üêÇ'; // O Minotauro
                        }
                        
                        mazeContainer.appendChild(cell);
                    }
                }
            }

            function startMazeGame() {
                document.removeEventListener('keydown', handleMovement); 
                
                quizArea.classList.add('hidden');
                gameInfo.classList.add('hidden');
                resultArea.classList.add('hidden');
                mazeGame.classList.remove('hidden');
                
                resetMazePositions(); // Define as posi√ß√µes iniciais de her√≥i e minotauro
                renderMaze();
                mazeMessage.textContent = 'Fuja do Minotauro! Use as setas (‚Üë ‚Üì ‚Üê ‚Üí).';

                document.addEventListener('keydown', handleMovement);
            }

            // Fun√ß√µes para o movimento do Minotauro
            const dx = [-1, 1, 0, 0]; // Up, Down
            const dy = [0, 0, -1, 1]; // Left, Right

            function isValidMinotaurMove(row, col) {
                return row >= 0 && row < MAZE_ROWS && col >= 0 && col < MAZE_COLS && MAZE_MAP[row][col] !== 1;
            }

            function moveMinotaur() {
                // Implementa uma busca em largura (BFS) para encontrar o caminho mais curto at√© o jogador
                const queue = [{ row: minotaurPos.row, col: minotaurPos.col, path: [] }];
                const visited = new Set();
                visited.add(`${minotaurPos.row},${minotaurPos.col}`);

                while (queue.length > 0) {
                    const { row, col, path } = queue.shift();

                    if (row === playerPos.row && col === playerPos.col) {
                        // Encontrou o jogador, siga o primeiro passo do caminho
                        if (path.length > 0) {
                            minotaurPos.row = path[0].row;
                            minotaurPos.col = path[0].col;
                        }
                        return; // Minotauro moveu
                    }

                    for (let i = 0; i < 4; i++) {
                        const newRow = row + dx[i];
                        const newCol = col + dy[i];

                        if (isValidMinotaurMove(newRow, newCol) && !visited.has(`${newRow},${newCol}`)) {
                            visited.add(`${newRow},${newCol}`);
                            queue.push({ row: newRow, col: newCol, path: [...path, { row: newRow, col: newCol }] });
                        }
                    }
                }
                // Se n√£o conseguir encontrar um caminho (o que n√£o deve acontecer em um labirinto conectado),
                // o Minotauro n√£o se move.
            }


            function handleMovement(event) {
                let newRow = playerPos.row;
                let newCol = playerPos.col;
                let moved = false;

                switch (event.key) {
                    case 'ArrowUp':
                        newRow--;
                        moved = true;
                        break;
                    case 'ArrowDown':
                        newRow++;
                        moved = true;
                        break;
                    case 'ArrowLeft':
                        newCol--;
                        moved = true;
                        break;
                    case 'ArrowRight':
                        newCol++;
                        moved = true;
                        break;
                }

                if (moved) {
                    event.preventDefault(); 
                    
                    if (newRow >= 0 && newRow < MAZE_ROWS && newCol >= 0 && newCol < MAZE_COLS && MAZE_MAP[newRow][newCol] !== 1) {
                        
                        playerPos.row = newRow;
                        playerPos.col = newCol;
                        minotaurMoveCounter++;

                        // Movimento do Minotauro a cada 2 movimentos do jogador
                        if (minotaurMoveCounter % 2 === 0) { 
                            moveMinotaur();
                        }

                        // Verifica colis√£o Minotauro-Jogador
                        if (playerPos.row === minotaurPos.row && playerPos.col === minotaurPos.col) {
                            mazeMessage.textContent = '‚ùå O Minotauro te pegou! Fim de jogo no labirinto!';
                            alert('GAME OVER no Labirinto! O Minotauro te alcan√ßou. Recomece sua jornada.');
                            // Para o jogo e volta para a tela inicial do quiz
                            startGame(); 
                            return; 
                        }

                        if (MAZE_MAP[newRow][newCol] === 3) {
                            finishMazeGame(true);
                        } else {
                            renderMaze();
                        }
                    } else {
                        mazeMessage.textContent = 'Parede de pedra. Caminho bloqueado!';
                        setTimeout(() => mazeMessage.textContent = 'Fuja do Minotauro! Use as setas (‚Üë ‚Üì ‚Üê ‚Üí).', 1000);
                    }
                }
            }

            function finishMazeGame(success) {
                document.removeEventListener('keydown', handleMovement);

                if (success) {
                    score += 50; 
                    obolos += 10;
                    
                    mazeMessage.textContent = 'üèÜ VIT√ìRIA! Voc√™ escapou do Labirinto do Minotauro!';
                    alert(`Pela sua coragem, voc√™ recebe 50 Pontos B√¥nus e 10 √ìbolos de Ouro!`);
                    
                    // Vai para a tela de resultado final
                    showResult(false);
                } else {
                     // N√£o h√° falha por tempo ou vidas no labirinto, apenas por ser pego pelo Minotauro.
                     // A l√≥gica de "perder" no labirinto j√° leva para o startGame (reiniciar quiz).
                }
            }

            // --- LISTENERS E IN√çCIO ---
            startButton.addEventListener('click', startGame);

            nextButton.addEventListener('click', () => {
                currentQuestionIndex++;
                loadQuestion();
            });

            restartButton.addEventListener('click', startGame);
            mazeRestartBtn.addEventListener('click', startGame);

            favorAtenaBtn.addEventListener('click', useFavorAtena);
            favorHermesBtn.addEventListener('click', useFavorHermes);

            // Inicialmente, tudo exceto a tela de in√≠cio est√° oculto
            quizArea.classList.add('hidden');
            gameInfo.classList.add('hidden');
            resultArea.classList.add('hidden');
            mazeGame.classList.add('hidden');

        });
    </script>
</body>
</html>